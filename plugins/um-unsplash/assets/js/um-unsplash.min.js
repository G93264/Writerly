jQuery(document).ready(function(p){var r='<p style="text-align:center;">'+wp.i18n.__("Loading...","um-unsplash")+"</p>",d='<p style="text-align:center;">'+wp.i18n.__("No result was found.","um-unsplash")+"</p>";p(document.body).on("click",".um-unsplash-trigger",function(){return p("body").addClass("um_unsplash_overlay").trigger("um_unsplash_overlay_show"),UM.dropdown.hideAll(),!1}),p(document.body).on("click","#um_unsplash_remove_modal",function(){p("body").removeClass("um_unsplash_overlay").trigger("um_unsplash_overlay_hide")}),p("body").on("um_unsplash_overlay_show",function(){var n=p(".um-unsplash-modal");n.find(".um-unsplash-modal-body-ajax-content").html(r);var a=um_unsplash_settings.proxy_url+"/search/"+um_unsplash_settings.license,s=um_unsplash_settings.default_keyword,e=a+"/"+um_unsplash_settings.number_of_photos+"/"+s+"/1";p.get(e,function(a){var u="",s=JSON.parse(JSON.stringify(a));if(1==s.success){var e=JSON.parse(s.data.body);p(e.results).each(function(a,s){var e=s.id,n=s.user.name,l=(s.user.username,s.links.download),o=s.links.download_location,t=s.user.links.html,r=s.urls.thumb,d=s.urls.full+"&w=1000&h=370&fit=crop";u+='<input class="unsplash_img_radio" type="radio" id="'+e+'" name="unsplash_img" data-id="'+e+'" value="'+d+'" data-user="'+n+'" data-download="'+l+'" data-user_profile="'+t+'" data-download_location="'+o+'"/><label for="'+e+'" style="background-image:url('+r+');"></label>'}),u+='<div class="selected-image"></div>'}else console.warn("Can not get Unsplash images",s),u+="<p>"+wp.i18n.__("Unexpected Error!","um-unsplash")+"</p>";n.find(".um-unsplash-modal-body-ajax-content").html(u)})}).on("um_unsplash_overlay_hide",function(){var a=p(".um-unsplash-modal");a.find(".um-unsplash-modal-body-ajax-content").html(""),a.find("form").trigger("reset")}),p(document.body).on("click","#um-unsplash-submit",function(){var e=p(this);if(!e.hasClass("disabled")){var s=e.parents(".um-unsplash-modal").find("form.um-unsplash-form"),n=p("body").find(".um-cover-e"),l=n.find("img"),a=p("#um-unsplash-cropable");if(a.length&&a.attr("src"))p(".unsplash_img_radio:checked").val(a.attr("src"));if(p(".unsplash_img_radio:checked").length){var o=p(".unsplash_img_radio:checked").attr("data-user"),t=p(".unsplash_img_radio:checked").attr("id"),r=p(".unsplash_img_radio:checked").attr("data-user_profile"),d=p(".unsplash_img_radio:checked").attr("data-download"),u=p(".unsplash_img_radio:checked").attr("data-download_location");s.find('[name="photo_author"]').val(o),s.find('[name="photo_author_url"]').val(r),s.find('[name="photo_download_url"]').val(d),s.find('[name="photo_download_location"]').val(u),s.find('[name="photo_id"]').val(t)}e.addClass("disabled");var i=s.serialize();wp.ajax.send({data:i,success:function(a){var s=a.image.replace("&amp;","&");l.length?l.attr("src",s):n.html(a.img_html),p("#um_unsplash_remove_modal").trigger("click"),e.removeClass("disabled")},error:function(a){s.find(".um-unsplash-form-response").html(a),e.removeClass("disabled")}})}}),p(document.body).on("click","#um-unsplash-photo-search-btn",function(a){a.preventDefault();var s=p("#um-unsplash-photo-search-field");if(""!==s.val()){var n=p(this).parents(".um-unsplash-modal").find(".um-unsplash-modal-body-ajax-content");n.html(r);var e=s.val(),l=um_unsplash_settings.proxy_url+"/search/"+um_unsplash_settings.license,o=um_unsplash_settings.number_of_photos,t=l+"/"+o+"/"+e;p.get(t+"/1",function(a){var u="",s=JSON.parse(JSON.stringify(a));if(1==s.success){var e=JSON.parse(s.data.body);0===e.total?u+=d:(p(e.results).each(function(a,s){var e=s.id,n=s.user.name,l=(s.user.username,s.links.download),o=s.links.download_location,t=s.user.links.html,r=s.urls.thumb,d=s.urls.full+"&w=1000&h=370&fit=crop";u+='<input class="unsplash_img_radio" type="radio" id="'+e+'" name="unsplash_img" data-id="'+e+'" value="'+d+'" data-user="'+n+'" data-download="'+l+'" data-user_profile="'+t+'" data-download_location="'+o+'"/><label for="'+e+'" style="background-image:url('+r+');"></label>'}),e.total>o&&(u+='<p class="um-unsplash-ajax-load-more-holder"><a class="um-unsplash-ajax-load-more" href="javascript:void(0);" data-more="'+e.total+'" data-per_page="'+o+'" data-url="'+t+'" data-page="2">'+wp.i18n.__("Load more","um-unsplash")+" &raquo;</a></p>")),u+='<div class="selected-image"></div>'}else console.warn("Can not search Unsplash images",s),u+="<p>"+wp.i18n.__("Unexpected Error!","um-unsplash")+"</p>";n.html(u)})}}),p(document.body).on("click",".um-unsplash-ajax-load-more",function(){var n=p(this),l=n.parents(".um-unsplash-modal").find(".um-unsplash-modal-body-ajax-content"),o=n.data("url"),t=n.data("page"),r=n.data("per_page");p.get(o+"/"+t,function(a){var u="",s=JSON.parse(JSON.stringify(a));if(1==s.success){var e=JSON.parse(s.data.body);0===e.total?u+=d:p(e.results).each(function(a,s){var e=s.id,n=s.user.name,l=(s.user.username,s.links.download),o=s.links.download_location,t=s.user.links.html,r=s.urls.thumb,d=s.urls.full+"&w=1000&h=370&fit=crop";u+='<input class="unsplash_img_radio" type="radio" id="'+e+'" name="unsplash_img" data-id="'+e+'" value="'+d+'" data-user="'+n+'" data-download="'+l+'" data-user_profile="'+t+'" data-download_location="'+o+'"/><label for="'+e+'" style="background-image:url('+r+');"></label>'}),e.results.length&&(u+='<p class="um-unsplash-ajax-load-more-holder"><a class="um-unsplash-ajax-load-more" href="javascript:void(0);" data-more="'+e.total+'" data-per_page="'+r+'" data-url="'+o+'"" data-page="'+(1*t+1)+'">'+wp.i18n.__("Load more","um-unsplash")+" &raquo;</a></p>")}else console.warn("Can not load Unsplash images",s),u+="<p>"+wp.i18n.__("Unexpected Error!","um-unsplash")+"</p>";n.parent(".um-unsplash-ajax-load-more-holder").remove(),l.find(".selected-image").before(u)})}),p(document.body).on("change",".unsplash_img_radio",function(){p(".unsplash_img_radio:checked").length&&(p("#um_unsplash_view_image").css("display","inline-block"),p(".um-unsplash-modal-body").find(".selected-image").html(""),p("body").find(".um-unsplash-modal-footer").find(".um-modal-btn.disabled").removeClass("disabled"))}),p(document.body).on("click","#um_unsplash_view_image",function(){var a=p(".unsplash_img_radio:checked");if(a.length){var s=a.val();p(".um-unsplash-modal-body").find(".selected-image").html('<img id="um-unsplash-cropable" src="'+s+'" alt="" /><span class="um-unsplash-crop-adjustment-buttons"><a id="fp-y-up-button" class="button" href="javascript:void(0);"><i class="um-faicon-chevron-up"></i></a><a id="fp-y-down-button" class="button" href="javascript:void(0);"><i class="um-faicon-chevron-down"></i></a></span>')}p(this).css("display","none")}),p(document.body).on("click","#fp-y-up-button",function(){if(!p(this).hasClass("disabled")){var a=p("#um-unsplash-cropable");if(a.length){var s=a.attr("src");if(s=(s=s.replace("&crop=entropy","")).replace("&crop=focalpoint",""),-1<(s+="&crop=focalpoint").indexOf("&fp-y=")){var e=parseInt(a.data("fpy"));if(0<e){var n=e-1,l="0."+e;0===e&&(l=0);var o=0;1<=n&&(o="0."+n),s=s.replace("&fp-y="+l,"&fp-y="+o),a.data("fpy",n)}}else s+="&fp-y=0.1",a.data("fpy","1");a.attr("src",s),p(document).trigger("um_unsplash_cover_position_change")}}}),p(document.body).on("click","#fp-y-down-button",function(){if(!p(this).hasClass("disabled")){var a=p("#um-unsplash-cropable");if(a.length){var s=a.attr("src");if(s=(s=s.replace("&crop=entropy","")).replace("&crop=focalpoint",""),-1<(s+="&crop=focalpoint").indexOf("&fp-y=")){var e=parseInt(a.data("fpy"));if(e<9){var n=e+1;a.data("fpy",n);var l="0."+e;0===e&&(l=0),s=s.replace("&fp-y="+l,"&fp-y=0."+n)}}else s+="&fp-y=0.5",a.data("fpy","5");a.attr("src",s),p(document).trigger("um_unsplash_cover_position_change")}}})});